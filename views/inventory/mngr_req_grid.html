{{extend 'layout.html'}}
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.css">
<div class="col-md-12">
    <div class="card card-underline"> 
        <div class="card-head"> 
            <ul class="nav nav-tabs pull-right" data-toggle="tabs">
                <!-- <li class=""><a href="#" onclick=window.location="{{=URL('stk_req_add_form')}}";>+ ADD NEW</a></li> -->
                <!-- <li class="active"><a href="#" >BROWSE</a></li>mngr_req_grid -->
            </ul>
            <!-- <span class="card-title">STOCK TRANSACTIONS FOR APPROVAL</span> -->
            <span class="card-title">{{=auth.user.first_name.upper()}} WORKFLOW</span>
        </div>
        <div class="card-body tab-content">            
            <div>
              <ul class="nav nav-pills" role="tablist">
                {{ _usr = db(db.User_Department.user_id == auth.user_id).select().first() }}
                {{ if not _usr: }}
                <li role="presentation"><a href="#stock_request" aria-controls="stock_request" role="tab" data-toggle="tab">Stock Request <span class="badge">{{=db((db.Stock_Request.srn_status_id == 4) & (db.Stock_Request.dept_code_id != 3)).count()}}</span></a></li>                
                <li role="presentation"><a href="#sales_order" aria-controls="sales_order" role="tab" data-toggle="tab">Sales Order <span class="badge">{{=db((db.Sales_Order.status_id == 4) & (db.Sales_Order.dept_code_id != 3) & (db.Sales_Order.cancelled == False)).count()}}</span></a></li>
                <li role="presentation"><a href="#sales_return" aria-controls="sales_return" role="tab" data-toggle="tab">Sales Return <span class="badge">{{=db((db.Sales_Return.status_id == 4) & (db.Sales_Order.dept_code_id != 3)).count()}}</span></a></li>                
                <li role="presentation"><a href="#purchase_request" aria-controls="purchase_request" role="tab" data-toggle="tab">Purchase Request <span class="badge">{{=db((db.Purchase_Request.status_id == 19) & (db.Purchase_Request.dept_code_id != 3)).count()}}</span></a></li>
                <li role="presentation"><a href="#obsolescence" aria-controls="obsolescence" role="tab" data-toggle="tab">Obsolescence of Stocks <span class="badge">{{=db((db.Obsolescence_Stocks.status_id == 4) & (db.Obsolescence_Stocks.dept_code_id != 3)).count()}}</span></a></li>
                
                {{ else: }}
                <li role="presentation"><a href="#stock_request" aria-controls="stock_request" role="tab" data-toggle="tab">Stock Request <span class="badge">{{=db((db.Stock_Request.srn_status_id == 4) & (db.Stock_Request.dept_code_id == 3)).count()}}</span></a></li>
                <li role="presentation"><a href="#sales_order" aria-controls="sales_order" role="tab" data-toggle="tab">Sales Order <span class="badge">{{=db((db.Sales_Order.status_id == 4) & (db.Sales_Order.dept_code_id == 3) & (db.Sales_Order.cancelled == False)).count()}}</span></a></li>
                <li role="presentation"><a href="#sales_return" aria-controls="sales_return" role="tab" data-toggle="tab">Sales Return <span class="badge">{{=db((db.Sales_Return.status_id == 4) & (db.Sales_Return.dept_code_id == 3)).count()}}</span></a></li>                
                <li role="presentation"><a href="#purchase_request" aria-controls="purchase_request" role="tab" data-toggle="tab">Purchase Request <span class="badge">{{=db((db.Purchase_Request.status_id == 19) & (db.Purchase_Request.dept_code_id == 3)).count()}}</span></a></li>
                <li role="presentation"><a href="#obsolescence" aria-controls="obsolescence" role="tab" data-toggle="tab">Obsolescence of Stocks <span class="badge">{{=db((db.Obsolescence_Stocks.status_id == 4) & (db.Obsolescence_Stocks.dept_code_id == 3)).count()}}</span></a></li>
                                
                {{ pass }} 
              </ul>
              <div class="tab-content">  
                <div role="tabpanel" class="tab-pane active" id="stock_request">                        
                  {{=LOAD('inventory','stock_request_manager_grid.load', ajax = True, target = 'tblsr')}}                                                    
                </div>                   
                <div role="tabpanel" class="tab-pane" id="stock_adjustment">                        
                  {{=LOAD('inventory','stock_adjustment_manager_grid.load', ajax = True, target = 'tbladj')}}
                </div>                     
                <div role="tabpanel" class="tab-pane" id="sales_order">                        
                  {{=LOAD('sales','sales_order_manager_grid.load', ajax = True, target = 'tblso')}}
                </div>                    
                <div role="tabpanel" class="tab-pane" id="sales_return">                        
                  {{=LOAD('sales','sales_return_grid.load', ajax = True, target = 'tblsrt')}}
                </div>                   
                <div role="tabpanel" class="tab-pane" id="purchase_request">                        
                  {{=LOAD('procurement','purchase_request_grid.load', ajax = True, target = 'PRtbl')}}
                </div>                     
                <div role="tabpanel" class="tab-pane" id="obsolescence">                        
                  {{=LOAD('inventory','get_obsolescence_of_stocks_workflow_grid.load', ajax = True)}}
                  
                </div>                     

              </div>
            </div>
        </div>
    </div>                
</div>

<script src="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.js"></script>
<script>
$(document).ready( function () {
    $('.table').DataTable();
});
</script>