{{extend 'layout.html'}}
<style>@import url("//unpkg.com/element-ui/lib/theme-chalk/index.css");</style>
<script src="//unpkg.com/vue"></script>
<script src="//unpkg.com/element-ui"></script>
<!-- <script scr="https://cdnjs.cloudflare.com/ajax/libs/vue-i18n/8.3.1/vue-i18n.min.js"></script> -->
<script src="//unpkg.com/element-ui/lib/umd/locale/en.js"></script>
<script>ELEMENT.locale(ELEMENT.lang.en)</script>
<div id="app">    
    <div class="col-md-12">
        <div class="card card-underline">
            <div class="card-head">
                <ul class="nav nav-tabs pull-right" data-toggle="tabs">
                    <!-- <li class=""><a href="#" onclick=window.location="{{=URL('stk_req_add_form')}}";>+ ADD NEW</a></li> -->
                    <!-- <li class="active"><a href="#" >BROWSE</a></li>mngr_req_grid -->
                </ul>
                <span class="card-title">STOCK TRANSACTIONS FOR APPROVAL</span>
            </div>
            <div class="card-body tab-content">
                <template>                         
                    <el-tabs :tab-position="tabPosition" style="height: 100%;">
                        <el-tab-pane label="Stock Request">                            
                            {{=LOAD('inventory','stock_request_manager_grid.load', ajax = True)}}
                                                    
                        </el-tab-pane>
                        <el-tab-pane label="Sales Order">
                            <el-alert title="Sales Order" type="info" description="on progress" show-icon></el-alert>    
                        </el-tab-pane>
                        <el-tab-pane label="Sales Return">
                            <el-alert title="Sales Return" type="info" description="on progress" show-icon></el-alert>    
                        </el-tab-pane>                        
                    </el-tabs>
                    <el-dialog title="Itim Stock Requested" :visible.sync="dialogTableVisible">
                        <el-table :data="gridData">
                            <el-table-column property="date" label="Date" width="150"></el-table-column>
                            <el-table-column property="name" label="Name" width="200"></el-table-column>
                            <el-table-column property="address" label="Address"></el-table-column>
                        </el-table>
                    </el-dialog>                    
                </template>
            </div>
        </div>                
    </div>
</div>

<script>
var Main = {
    delimiters: ["{%","%}"],
    methods: {     
      linksClick(row) {
        window.open("{{=URL('inventory','mngr_req_details')}}" + "/" + row, '_top');        
      },
      toggleSelection(rows) {
        if (rows) {
          rows.forEach(row => {
            this.$refs.multipleTable.toggleRowSelection(row);
          });
        } else {
          this.$refs.multipleTable.clearSelection();    
        }
      },
      handleSelectionChange(val) {
        this.multipleSelection = val;
        // console.log(val);
      },

    },
    data() {
      return {
        
        {{import locale}}
        gridData: [ 
            {
                date: '2016-05-02',
                name: 'John Smith',
                address: 'No.1518,  Jinshajiang Road, Putuo District'
            },
        ],          
        dialogTableVisible: false,
        tabPosition: 'top',
        tableData: [{{for s in db(db.Stock_Request.srn_status_id == 4 ).select(db.Stock_Request.ALL, db.Transaction_Prefix.ALL, 
        orderby = ~db.Stock_Request.stock_request_no, left = db.Transaction_Prefix.on(db.Transaction_Prefix.id == db.Stock_Request.stock_request_no_id)):}}
        {
            tag: '{{=s.Stock_Request.id}}',                
            date: '{{=s.Stock_Request.stock_request_date}}',
            req_no: '{{=s.Transaction_Prefix.prefix}}{{=s.Stock_Request.stock_request_no}}',
            stk_src: '{{=s.Stock_Request.stock_source_id.location_name}}',
            stk_des: '{{=s.Stock_Request.stock_destination_id.location_name}}',
            stat: '{{=s.Stock_Request.srn_status_id.description}}',
            req_by: '{{=s.Stock_Request.created_by.first_name.upper()}} {{=s.Stock_Request.created_by.last_name.upper()}}',
            amount: '{{=locale.format('%.2f', s.Stock_Request.total_amount or 0, grouping = True)}}',
            req: '{{=s.Stock_Request.srn_status_id.required_action}}',          
        },{{pass}}],
        multipleSelection: []
      }
    }
  }
var Ctor = Vue.extend(Main)
new Ctor().$mount('#app')
</script>




